Судя по результатам вывода программы, можно сказать, что программа работает корректно только при 1 потоке-генераторе и 1 потоке-обработчике. 
Это связано с тем, что в программе используется метод notify_one() класса условных переменных, который способен уведомлять лишь один поток.